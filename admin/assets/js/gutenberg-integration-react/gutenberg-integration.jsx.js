(()=>{"use strict";const e=window.wp.element,t=window.wp.components,s=window.wp.i18n,a=window.ReactJSXRuntime,i=window.jQuery,{ajax_url:n,get_gutenberg_attachment_pml_data_nonce:l,toggle_protection_nonce:d,save_quick_edit_form_nonce:o,plugin_prefix:r,text_error:c,text_loading:m,global_redirect_url_placeholder:p,select_options_bot_access:u}="undefined"!=typeof pml_gutenberg_params?pml_gutenberg_params:{},_=({attachment:_})=>{if(!_||!_.id)return null;const g=_.id,[h,w]=(0,e.useState)(!0),[f,x]=(0,e.useState)(!1),[v,j]=(0,e.useState)(""),[b,k]=(0,e.useState)(""),[y,S]=(0,e.useState)({user_allow:0,user_deny:0,role_allow:0,role_deny:0}),[N,T]=(0,e.useState)("#"),[A,$]=(0,e.useState)(!1),[D,C]=(0,e.useState)(!1),[O,P]=(0,e.useState)(!1),[R,L]=(0,e.useState)(""),[U,B]=(0,e.useState)("");return(0,e.useEffect)(()=>{w(!0),L(""),B(""),$(!1),i.ajax({url:n,type:"POST",data:{action:`${r}_get_gutenberg_attachment_pml_data`,nonce:l,attachment_id:g},dataType:"json",success:e=>{e.success&&e.data?(x(e.data.is_protected||!1),j(e.data.redirect_url||""),k(e.data.allow_bots||""),S(e.data.list_counts||{user_allow:0,user_deny:0,role_allow:0,role_deny:0}),T(e.data.edit_link||"#")):L(e.data?.message||c)},error:()=>L(c),complete:()=>w(!1)})},[g]),h?(0,a.jsxs)("div",{className:"pml-gutenberg-loading settings",children:[(0,a.jsx)(t.Spinner,{}),(0,a.jsx)("span",{children:m||(0,s.__)("Loading PML settings...","protected-media-links")})]}):(0,a.jsxs)(a.Fragment,{children:[R&&(0,a.jsx)(t.Notice,{status:"error",isDismissible:!0,onRemove:()=>L(""),children:R}),U&&(0,a.jsx)(t.Notice,{status:"success",isDismissible:!1,onRemove:()=>B(""),children:U}),(0,a.jsxs)("div",{className:"pml-grid-status-toggle",children:[(0,a.jsx)("label",{className:"name",children:(0,s.__)("Access Lens Status","protected-media-links")}),(0,a.jsx)("span",{className:"pml-status-text-grid "+(f?"is-protected":"is-unprotected"),children:f?(0,s.__)("Protected","protected-media-links"):(0,s.__)("Unprotected","protected-media-links")}),(0,a.jsxs)(t.Button,{className:"button button-small pml-toggle-protection-grid "+(D?"is-busy":""),onClick:()=>{return e=!f,C(!0),L(""),B(""),void i.ajax({url:n,type:"POST",data:{action:`${r}_toggle_protection_status`,nonce:d,attachment_id:g,is_protected:e},dataType:"json",success:e=>{e.success?(x(e.data.is_protected),B(e.data.message||(0,s.__)("Protection status updated.","protected-media-links"))):L(e.data?.message||c)},error:()=>{L(c)},complete:()=>{C(!1),setTimeout(()=>B(""),3e3)}});var e},disabled:D,"aria-live":"polite",children:[(0,a.jsx)(t.Icon,{icon:f?"unlock":"lock",className:"pml-button-icon"}),f?(0,s.__)("Unprotect","protected-media-links"):(0,s.__)("Protect","protected-media-links"),D&&(0,a.jsx)(t.Spinner,{})]})]}),(0,a.jsx)("div",{className:"pml-grid-trigger-wrapper",children:(0,a.jsxs)(t.Button,{isLink:!0,onClick:()=>$(!A),"aria-expanded":A,className:"pml-manage-grid-settings",children:[(0,s.__)("Manage PML","protected-media-links"),(0,a.jsx)(t.Icon,{icon:A?"arrow-up-alt2":"arrow-down-alt2"})]})}),(0,a.jsxs)("div",{className:"pml-grid-form-container "+(A?"is-open":""),children:[(0,a.jsx)("div",{className:"pml-gutenberg-form-field",children:(0,a.jsx)(t.TextControl,{label:(0,s.__)("Unauthorized Redirect URL Override","protected-media-links"),value:v,onChange:j,placeholder:p||(0,s.__)("Global default","protected-media-links"),help:(0,s.__)("Leave blank to use global default.","protected-media-links"),disabled:O,type:"url"})}),(0,a.jsx)("div",{className:"pml-gutenberg-form-field",children:(0,a.jsx)(t.SelectControl,{label:(0,s.__)("Bot Access Override","protected-media-links"),value:b,options:u||[],onChange:k,help:(0,s.__)("Override global bot access setting for this file.","protected-media-links"),disabled:O})}),(0,a.jsx)("div",{className:"pml-gutenberg-form-actions",children:(0,a.jsx)(t.Button,{className:"button button-primary button-small",onClick:()=>{P(!0),L(""),B(""),i.ajax({url:n,type:"POST",data:{action:`${r}_save_quick_edit_form`,nonce:o,attachment_id:g,[`${r}_redirect_url`]:v,[`${r}_allow_bots_for_file`]:b},dataType:"json",success:e=>{e.success?B(e.data?.message||(0,s.__)("Overrides saved.","protected-media-links")):L(e.data?.message||c)},error:()=>L(c),complete:()=>{P(!1),setTimeout(()=>B(""),3e3)}})},isBusy:O,disabled:O||D,children:O?(0,s.__)("Saving...","protected-media-links"):(0,s.__)("Save Overrides","protected-media-links")})}),(0,a.jsxs)("div",{className:"pml-meta-field-group pml-quick-edit-advanced-link",children:[(0,a.jsx)("hr",{className:"pml-meta-hr-dashed"}),(0,a.jsx)("p",{children:(0,a.jsxs)("a",{href:N,target:"_blank",rel:"noopener noreferrer",children:[(0,s.__)("Advanced Settings (User/Role Lists, Token Params)...","protected-media-links"),"Â  ",(0,a.jsx)(t.Icon,{icon:"external",size:16})," "]})}),(0,a.jsx)("p",{className:"description pml-field-description",children:(0,s.sprintf)(/* translators: 1: User Allow count, 2: User Deny count, 3: Role Allow count, 4: Role Deny count */ /* translators: 1: User Allow count, 2: User Deny count, 3: Role Allow count, 4: Role Deny count */
(0,s.__)("Current lists: User Allow (%1$d), User Deny (%2$d), Role Allow (%3$d), Role Deny (%4$d).","protected-media-links"),y.user_allow,y.user_deny,y.role_allow,y.role_deny)})]})]})]})};i(document).ready(function(){if("undefined"==typeof pml_gutenberg_params)return;let t=0;!function s(){"undefined"!=typeof wp&&wp.media?.view?.Attachment?.Details?function(){if("undefined"==typeof wp||!wp.media?.view?.Attachment?.Details)return;if(wp.media.view.Attachment.Details.prototype.pmlExtended)return;const t=wp.media.view.Attachment.Details,s=function(){if(this.el&&this.model&&this.model.get("id")){const t="pml-grid-settings-section",s=`pml-react-mount-point-${this.cid}`,n=i(this.el).closest(".media-modal-content").find(".media-sidebar");if(!n.length)return;n.find(`.${t}`).remove();const l=i(`<div class="${t}"></div>`);l.append(`<div class="${s}"></div>`),n.append(l);const d=n.find(`.${s}`);d.length&&(0,e.render)((0,a.jsx)(_,{attachment:this.model.toJSON()}),d[0])}};if(wp.media.view.Attachment.Details=t.extend({pmlExtended:!0,render:function(){return t.prototype.render.apply(this,arguments),setTimeout(()=>s.call(this),0),this}}),wp.media.view.Attachment.Details.TwoColumn&&!wp.media.view.Attachment.Details.TwoColumn.prototype.pmlExtended){const e=wp.media.view.Attachment.Details.TwoColumn;wp.media.view.Attachment.Details.TwoColumn=e.extend({pmlExtended:!0,render:function(){return e.prototype.render.apply(this,arguments),setTimeout(()=>s.call(this),0),this}})}}():t<20&&(t++,setTimeout(s,500))}()})})();